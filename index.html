<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>G√©n√©rateur de GIF avec transparence</title>
  <style>
    body { font-family: sans-serif; padding: 20px; background: #222; color: white; }
    input, button { margin: 10px 0; }
    #preview { margin-top: 20px; max-width: 100%; }
  </style>
</head>
<body>
  <h1>GIF Maker (transparence + tri)</h1>
  <input type="file" id="images" multiple accept="image/*">
  <br>
  <label>Vitesse (ms par image) : <input type="number" id="delay" value="200"></label>
  <br>
  <button id="generate">G√©n√©rer le GIF</button>
  <br>
  <a id="downloadLink" style="display:none" download="result.gif">üì• T√©l√©charger le GIF</a>
  <br>
  <img id="preview" alt="Aper√ßu GIF" />

  <script src="https://cdnjs.cloudflare.com/ajax/libs/gif.js/0.2.0/gif.js"></script>
  <script>
    const input = document.getElementById("images");
    const delayInput = document.getElementById("delay");
    const preview = document.getElementById("preview");
    const downloadLink = document.getElementById("downloadLink");

    document.getElementById("generate").addEventListener("click", async () => {
      const files = Array.from(input.files);
      if (files.length === 0) return alert("Importe au moins une image.");

      // Tri alphab√©tique
      files.sort((a, b) => a.name.localeCompare(b.name, undefined, { numeric: true }));

      const gif = new GIF({
        workers: 2,
        quality: 10,
        transparent: 'rgba(0,0,0,0)', // g√®re transparence
        workerScript: 'https://cdnjs.cloudflare.com/ajax/libs/gif.js/0.2.0/gif.worker.js'
      });

      const delay = parseInt(delayInput.value);

      for (const file of files) {
        const img = await loadImage(file);
        const canvas = document.createElement("canvas");
        canvas.width = img.width;
        canvas.height = img.height;
        const ctx = canvas.getContext("2d");
        ctx.clearRect(0, 0, canvas.width, canvas.height); // important pour la transparence
        ctx.drawImage(img, 0, 0);
        gif.addFrame(ctx, {copy: true, delay: delay});
      }

      gif.on("finished", blob => {
        const url = URL.createObjectURL(blob);
        preview.src = url;
        downloadLink.href = url;
        downloadLink.style.display = "inline";
      });

      gif.render();
    });

    function loadImage(file) {
      return new Promise((resolve) => {
        const img = new Image();
        img.onload = () => resolve(img);
        img.src = URL.createObjectURL(file);
      });
    }
  </script>
</body>
</html>
