<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Créateur de GIF pixelisé</title>
  <style>
    body {
      background: #111;
      color: white;
      font-family: sans-serif;
      padding: 20px;
    }
    canvas {
      image-rendering: pixelated;
      border: 1px solid #555;
      margin-top: 10px;
    }
    #thumbs img {
      height: 64px;
      margin: 4px;
      image-rendering: pixelated;
    }
  </style>
</head>
<body>

<h1>Créateur de GIF pixelisé</h1>

<input type="file" id="images" multiple accept="image/*">
<br><br>
<label>Vitesse (ms/image):</label>
<input type="number" id="delay" value="200"><br><br>
<button id="generateBtn">🎞️ Générer le GIF</button>
<a id="downloadLink" style="display:none" download="animation.gif">📥 Télécharger le GIF</a>

<canvas id="canvas"></canvas>
<div id="thumbs"></div>
<p id="status"></p>

<script src="https://cdnjs.cloudflare.com/ajax/libs/gif.js/0.2.0/gif.js"></script>
<script>
const input = document.getElementById('images');
const delayInput = document.getElementById('delay');
const canvas = document.getElementById('canvas');
const ctx = canvas.getContext('2d');
const thumbs = document.getElementById('thumbs');
const status = document.getElementById('status');
const generateBtn = document.getElementById('generateBtn');
const downloadLink = document.getElementById('downloadLink');

let frames = [];

input.addEventListener('change', async () => {
  thumbs.innerHTML = '';
  frames = [];
  status.textContent = "📂 Chargement des images...";
  const files = Array.from(input.files).sort((a, b) => a.name.localeCompare(b.name, undefined, {numeric: true}));

  for (const file of files) {
    const img = new Image();
    img.src = URL.createObjectURL(file);
    await new Promise(resolve => {
      img.onload = () => {
        frames.push(img);
        const thumb = img.cloneNode();
        thumbs.appendChild(thumb);
        resolve();
      };
    });
  }

  if (frames.length > 0) {
    canvas.width = frames[0].width;
    canvas.height = frames[0].height;
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    ctx.drawImage(frames[0], 0, 0);
  }

  status.textContent = `✅ ${frames.length} image(s) chargée(s)`;
});

generateBtn.addEventListener('click', () => {
  if (frames.length === 0) return alert("Charge des images d'abord !");
  status.textContent = "⏳ Génération du GIF en cours...";
  downloadLink.style.display = 'none';

  const gif = new GIF({
    workers: 2,
    quality: 1,
    workerScript: 'https://cdnjs.cloudflare.com/ajax/libs/gif.js/0.2.0/gif.worker.js',
    transparent: 0x00FF00, // Couleur verte improbable pour assurer la transparence
  });

  frames.forEach(img => {
    ctx.clearRect(0, 0, canvas.width, canvas.height); // empêche la superposition
    ctx.drawImage(img, 0, 0);
    gif.addFrame(ctx, {copy: true, delay: parseInt(delayInput.value)});
  });

  gif.on('finished', function(blob) {
    const url = URL.createObjectURL(blob);
    downloadLink.href = url;
    downloadLink.style.display = 'inline-block';
    status.textContent = "✅ GIF prêt à être téléchargé !";
  });

  gif.render();
});
</script>

</body>
</html>
