<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Monde Infini Pixelisé</title>
  <style>
    html, body {
      margin: 0;
      overflow: hidden;
    }
    canvas {
      image-rendering: pixelated;
      display: block;
    }
  </style>
</head>
<body>
<canvas id="canvas"></canvas>
<script>
const canvas = document.getElementById("canvas");
const ctx = canvas.getContext("2d");
canvas.width = window.innerWidth;
canvas.height = window.innerHeight;

let width = canvas.width;
let height = canvas.height;

// Position et zoom
let offsetX = 0;
let offsetY = 0;
let scale = 16; // taille d’un “pixel” en écran

function pseudoRandom(x, y) {
  let seed = (x * 374761393 + y * 668265263) ^ (x * y);
  seed = (seed ^ (seed >> 13)) * 1274126177;
  seed = (seed ^ (seed >> 16));
  return (seed >>> 0) / 4294967295;
}

function getColor(x, y) {
  const h = Math.floor(pseudoRandom(x, y) * 360);
  const s = Math.floor(pseudoRandom(x + 13, y + 17) * 100);
  const l = Math.floor(pseudoRandom(x - 9, y + 22) * 100);
  return `hsl(${h}, ${s}%, ${l}%)`;
}

function draw() {
  ctx.clearRect(0, 0, width, height);

  const startX = Math.floor(offsetX);
  const startY = Math.floor(offsetY);
  const endX = Math.ceil(offsetX + width / scale);
  const endY = Math.ceil(offsetY + height / scale);

  for (let x = startX; x < endX; x++) {
    for (let y = startY; y < endY; y++) {
      ctx.fillStyle = getColor(x, y);
      const screenX = (x - offsetX) * scale;
      const screenY = (y - offsetY) * scale;
      ctx.fillRect(screenX, screenY, scale, scale);
    }
  }
}

// Zoom avec molette
canvas.addEventListener("wheel", (e) => {
  const zoom = e.deltaY < 0 ? 1.1 : 0.9;
  const mouseX = e.offsetX;
  const mouseY = e.offsetY;

  const worldX = offsetX + mouseX / scale;
  const worldY = offsetY + mouseY / scale;

  scale *= zoom;
  if (scale < 1) scale = 1; // limite minimal

  offsetX = worldX - mouseX / scale;
  offsetY = worldY - mouseY / scale;

  draw();
});

// Déplacement à la souris
let dragging = false;
let lastX, lastY;
canvas.addEventListener("mousedown", (e) => {
  dragging = true;
  lastX = e.clientX;
  lastY = e.clientY;
});
canvas.addEventListener("mousemove", (e) => {
  if (dragging) {
    const dx = e.clientX - lastX;
    const dy = e.clientY - lastY;
    offsetX -= dx / scale;
    offsetY -= dy / scale;
    lastX = e.clientX;
    lastY = e.clientY;
    draw();
  }
});
canvas.addEventListener("mouseup", () => dragging = false);
canvas.addEventListener("mouseleave", () => dragging = false);

// Resize
window.addEventListener("resize", () => {
  width = window.innerWidth;
  height = window.innerHeight;
  canvas.width = width;
  canvas.height = height;
  draw();
});

draw();
</script>
</body>
</html>
