<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>GIF Pixel Art</title>
  <style>
    body { background: #222; color: #fff; font-family: sans-serif; padding: 20px; }
    input, button { margin: 10px 0; display: block; }
    #thumbs img, #preview {
      image-rendering: pixelated;
      image-rendering: crisp-edges;
      max-height: 100px;
      margin: 5px;
      border: 1px solid #555;
    }
  </style>
</head>
<body>
  <h1>CrÃ©er un GIF pixelisÃ© avec transparence</h1>

  <input type="file" id="images" multiple accept="image/*">
  <label for="delay">Vitesse (ms/image):</label>
  <input type="number" id="delay" value="200">
  <button id="generate" disabled>ğŸï¸ GÃ©nÃ©rer le GIF</button>
  <div id="status"></div>
  <div id="thumbs"></div>
  <img id="preview" />
  <a id="download" style="display:none" download="gif_final.gif">ğŸ“¥ TÃ©lÃ©charger</a>

  <script src="https://cdn.jsdelivr.net/npm/gifshot@0.3.2/build/gifshot.min.js"></script>
  <script>
    const input = document.getElementById('images');
    const generateBtn = document.getElementById('generate');
    const preview = document.getElementById('preview');
    const download = document.getElementById('download');
    const status = document.getElementById('status');
    const thumbs = document.getElementById('thumbs');
    const delayInput = document.getElementById('delay');

    let imageURLs = [];

    input.addEventListener('change', () => {
      thumbs.innerHTML = '';
      const files = Array.from(input.files).sort((a, b) =>
        a.name.localeCompare(b.name, undefined, { numeric: true })
      );

      const readers = files.map(file => {
        return new Promise(resolve => {
          const reader = new FileReader();
          reader.onload = e => {
            const img = document.createElement('img');
            img.src = e.target.result;
            thumbs.appendChild(img);
            resolve(e.target.result);
          };
          reader.readAsDataURL(file);
        });
      });

      Promise.all(readers).then(results => {
        imageURLs = results;
        generateBtn.disabled = false;
      });
    });

    generateBtn.addEventListener('click', () => {
      status.textContent = "â³ GÃ©nÃ©ration...";
      preview.src = "";
      download.style.display = "none";

      gifshot.createGIF({
        images: imageURLs,
        interval: parseInt(delayInput.value) / 1000,
        preserveTransparency: true,
        transparent: 'rgba(0,0,0,0)',
        pixelRatio: 1,
        sampleInterval: 10,
        numWorkers: 2
      }, function (obj) {
        if (!obj.error) {
          preview.src = obj.image;
          download.href = obj.image;
          download.style.display = "inline-block";
          status.textContent = "âœ… GIF prÃªt !";
        } else {
          status.textContent = "âŒ Erreur : " + obj.error;
        }
      });
    });
  </script>
</body>
</html>
